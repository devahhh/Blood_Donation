{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Sign Up Start -->
<section id="sign-up">
  <div class="container-fluid my-3">
    <img src="{% static 'imgs/logo.png' %}" alt="">

    <form method="post">
      {% csrf_token %}
      <div class="form-group row my-3">
        <label for="inputName3" class="col-sm-2 col-form-label">Full Name</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="inputName3" name="name" 
                 placeholder="Full Name" required>
        </div>
      </div>
      <div class="form-group row my-3">
        <label for="inputEmail3" class="col-sm-2 col-form-label">Email</label>
        <div class="col-sm-10">
          <input type="email" class="form-control" id="inputEmail3" name="email" 
                 placeholder="Email" required>
        </div>
      </div>

      <div class="form-group row mb-3">
        <label for="inputPassword3" class="col-sm-2 col-form-label">Password</label>
        <div class="col-sm-10">
          <input type="password" class="form-control" id="inputPassword3" name="password" 
                 placeholder="Password" required>
        </div>
      </div>

      <div class="form-group row mb-3">
        <label for="inputDate" class="col-sm-2 col-form-label">Date of Birth</label>
        <div class="col-sm-10">
          <input type="date" class="form-control" id="inputDate" name="dob" required>
        </div>
      </div>

      <div class="form-group row mb-3">
        <label for="type" class="col-sm-2 col-form-label">Blood Type</label>
        <div class="col-sm-10">
          <select name="type" id="type" class="form-control" required>
            <option value="" disabled selected>Select Blood Type</option>
            {% for blood_type in blood_types %}
              <option value="{{ blood_type }}">{{ blood_type }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="form-group row mb-3">
        <label for="phone" class="col-sm-2 col-form-label">Phone Number</label>
        <div class="col-sm-10">
          <input type="tel" class="form-control" id="phone" name="phone" 
                 placeholder="Phone Number" required>
        </div>
      </div>

      <div class="form-group row mb-3">
        <div class="col-sm-10 offset-sm-2">
          <button class="btn btn-dark px-4" type="submit">Submit</button>
        </div>
      </div><br><br><br>
    </form>

  </div>
</section>
<script>
  const existingEmails = {{ emails|safe }};
  const existingPhones = {{ phones|safe }};
  const bloodTypes = {{ blood_types|safe }};
  const birthyear = new Date().getFullYear() - 18;
  document.getElementById('inputDate').setAttribute('max', birthyear + '-12-31');
  console.log(birthyear);
  
  console.log(existingPhones);
  console.log(existingEmails);
  if (existingEmails.length > 0) {
    document.getElementById('inputEmail3').addEventListener('input', function() {
      const email = (this.value).toLowerCase();
      if (existingEmails.includes(email)) {
        this.value = '';
        alert('This email is already registered. Please use a different email.');
      } else {
        this.setCustomValidity('');
      }
    });
  }
  if (existingPhones.length > 0) {
    document.getElementById('phone').addEventListener('input', function() {
      const phone = this.value;
      if (existingPhones.includes(phone)) {
        this.value = '';
        alert('This phone number is already registered. Please use a different phone number.');
      } else {
        this.setCustomValidity('');
      }
    });
  }
  if (bloodTypes.length > 0) {
    const typeSelect = document.getElementById('type');
    typeSelect.innerHTML = '<option value="" disabled selected>Select Blood Type</option>';
    bloodTypes.forEach(function(bloodType) {
      const option = document.createElement('option');
      option.value = bloodType;
      option.textContent = bloodType;
      typeSelect.appendChild(option);
    });
  }
  if (document.getElementById('inputDate').value > birthyear + '-12-31') {
    document.getElementById('inputDate').value = '';
    alert('You must be at least 18 years old to sign up.');
  }
</script>
<!-- Sign Up End -->

{% endblock content %}
